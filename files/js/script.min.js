"use strict";$(document).ready(function(){var a=$(".content").attr("dt-modules"),b={page:$("body")};if(a.indexOf("#modal#")>=0){b.msg=$("footer span"),b.win=$("#modal");var c=function(a,c,d){var e=b.win.find("div.modal-body"),f=b.win.find("div.modal-footer"),g=f.attr("dt-btn").split(","),h={dismiss:"<button type='button' class='btn btn-danger' data-dismiss='modal'>"+g[0]+"</button>",continue:"<button type='button' class='btn btn-warning' id='modal-button-continue'>"+g[1]+"</button>"},i="",d=d||0;e.html(a),f.html(""),$.each(c,function(a){$(h[c[a]]).appendTo(f)}),"function"==typeof d&&(i=$("#modal-button-continue"),i.on("click",function(){d()})),b.win.modal("show")},d=function(a){var c=b.msg.filter(function(){return $(this).attr("dt-action")===a});return c.text()};""!==b.msg.eq(0).text()&&c(b.msg.text(),["dismiss"])}if(a.indexOf("#ajax#")>=0)var e=function(a,b,c,d){return $.ajax({beforeSend:function(){"function"==typeof c&&c()},type:"POST",dataType:"json",url:a,data:b}).done(function(a){"function"==typeof d&&d(a)})},f=!1,g=!1;if(a.indexOf("#social#")>=0&&(b.social=$("a[role='share']"),b.social.on("click",function(a){var c=$("title"),f=["https://www.facebook.com/sharer/sharer.php?u="+window.location.href+"&t="+c.text()+"&v=3","https://plus.google.com/share?url="+window.location.href,"https://twitter.com/intent/tweet?status="+c.text()+"%20"+window.location.href+"&related=micropat"],g=$(window),h=Number($(this).attr("parm-w")),i=Number($(this).attr("parm-h")),j=Math.round((g.width()-h)/2),k=Math.round((g.height()-i)/2);a.preventDefault(),j<0||k<0?window.open(f[b.social.index($(this))],"_blank"):window.open(f[b.social.index($(this))],"_blank","width= "+h+", height= "+i+", left="+j+", top="+k),e("files/php/controllers/share.php",{file:$(this).attr("dt-target")},"",function(a){console.log(a)})})),a.indexOf("#tabs#")>=0&&(b.menuItems=$("header.submenu a"),b.menuItems.on("click",function(a){var c=$("header.submenu span.btn-label"),d=$("div.tab");c.text($(this).text()),d.each(function(){$(this).removeClass("hidden").addClass("hidden")}),d.eq(b.menuItems.index($(this))).removeClass("hidden"),a.preventDefault()}),b.menuItems.eq(b.menuItems.eq(0).closest("ul").attr("dt-pointer")).trigger("click")),a.indexOf("#nav#")>=0&&(b.goTop=$(".btn-gotop"),b.goTop.on("click",function(){b.page.animate({scrollTop:0},"fast")})),a.indexOf("#options#")>=0&&(b.checkbutton=$(".checkbutton"),b.checkbutton.on("click",function(){var d,a=$(this).attr("role"),b=$(this).closest(".checkgroup"),c=[b.find("[role='main']"),b.find("[role='control']"),b.find("[role='slave']")];("main"!==a&&!c[0].hasClass("text-warning")||b.hasClass("dismiss"))&&c[0].addClass("text-warning"),("main"===a||b.hasClass("dismiss"))&&(b.toggleClass("dismiss"),b.hasClass("dismiss")?$.each(c,function(a){c[a].each(function(){$(this).removeClass("text-warning")})}):"main"===a&&c[1].addClass("text-warning")),"control"!==a||$(this).hasClass("text-warning")?"slave"===a&&($(this).toggleClass("text-warning"),c[1].removeClass("text-warning"),d=b.find(".text-warning"),(1===d.length||d.length>c[2].length)&&(c[2].each(function(){$(this).removeClass("text-warning")}),c[1].addClass("text-warning"))):($.each(c,function(a){a>0&&c[a].each(function(){$(this).removeClass("text-warning")})}),$(this).addClass("text-warning"))})),a.indexOf("#selectors#")>=0&&(b.selectButton=$(".selectButton"),b.selectButton.on("click",function(){var a=$(this).closest(".sheet"),c=a.find(".checkgroup"),d=a.find("label.rangevalue"),e=a.find(".selectButton"),f=e.index($(this)),g=$.parseJSON(b.page.attr("dt-settings")),h=Number(d.eq(f>1).text()),i=Number(d.eq(f<2).text());c.removeClass("dismiss"),c.children().removeClass("text-warning").addClass("text-warning"),h+=f%2===0?1:-1,(h<g[a.attr("dt-type")][0]||h>g[a.attr("dt-type")][1])&&(h=g[a.attr("dt-type")][h>g[a.attr("dt-type")]]),(h>i&&f<2||h<i&&f>1)&&(h=i),d.eq(f>1).text(h)})),a.indexOf("#form#")>=0&&(b.form=$("form"),b.form.on("submit",function(a){var j,k,l,h={},i=$(this).find(".serie");i.length?(i.each(function(a){k={},j=[$(this).find("[role='main']"),$(this).find("[role='control']"),$(this).find("[role='slave']"),$(this).find("label.rangevalue")],k.active=j[0].length?Number(j[0].hasClass("text-warning")):j[1].index($(this).find(".text-warning")),k.options=j[0].length?{}:"",k.range=j[0].length?{}:"",k.counter=0,j[2].length?j[2].each(function(a){(j[1].hasClass("text-warning")||$(this).hasClass("text-warning"))&&(k.options[k.counter++]=$(this).attr("value"))}):j[3].length&&j[3].each(function(a){k.range[a]=Number($(this).text())}),h[a]=j[0].length?JSON.stringify(k):JSON.stringify(k.active),k.active<0&&(l=!0)}),l?(c(d("survey"),["dismiss"]),a.preventDefault()):(k=$("input[name='data']"),k.val(JSON.stringify(h)),b.page.addClass("hidden"))):(k=$.trim($("textarea").val()),k.length&&!f?g?b.form.eq(0).submit():(a.preventDefault(),f=!0,k=$(".kaptcha"),j=$("input[name='kaptcha']"),e("files/php/controllers/kaptcha.php",{k:k.attr("dt-ref"),v:j.val()},"",function(a){a?(g=!0,b.form.eq(0).submit()):(c(d("no_kaptcha"),["dismiss"]),f=!1)})):(g||a.preventDefault(),f||c(d("no_message"),["dismiss"])))})),a.indexOf("#edit#")>=0){var h,i=function(){b.fields=$("[contenteditable]"),b.buttonEdit=$("button.btn-edit"),b.fields.unbind(),b.buttonEdit.unbind(),b.fields.on("keypress",function(a){return 13!=a.which}),b.fields.on("focus",function(){var a=$(this).parent();h=$.trim($(this).text()),a.hasClass("text")&&$(this).hasClass("text-warning")&&($(this).text(""),$(this).removeClass("text-warning"))}),b.fields.on("blur",function(){var a=$(this).parent(),b=$.trim($(this).text()),c=!0;if(""===b&&($(this).text(a.attr("dt-default")),a.hasClass("text")?$(this).addClass("text-warning"):c=!1),c&&h!==b){var d=JSON.parse(a.attr("dt-data"));d.value=b,e("files/php/controllers/update.php",d)}}),b.buttonEdit.on("click",function(){var g,a=$(this),f=[];switch(f.who=a.closest(".sheet").find("label").text(),$(this).attr("dt-action")){case"add":return f.data=JSON.parse(a.attr("dt-data")),f.parent=a.closest(".box").find(".sheets"),f.attr=f.parent.find(".sheet"),f.elm=$("<div class='sheet' style='display:none'><div class='header' dt-default='"+f.data.attribute+"'><label class='txt' contenteditable>"+f.data.attribute+"</label><span class='bar'></span></div><div class='text'><span class='txt text-warning' contentEditable></span><span class='bar'></span></div><p class='actions'><button type='button' dt-action='delete_subsection' class='btn btn-danger btn-edit'>x</button></p></div>"),f.elm.appendTo(f.parent).slideDown("slow"),void e("files/php/controllers/add.php",f.data,"",function(a){var b=[];b.holder=$(".sheets[dt-index='"+a.index+"']"),b.header=b.holder.find("div.header:last"),b.text=b.holder.find("div.text:last"),b.button=b.holder.find("button.btn-edit:last"),b.header.attr("dt-data",'{"index":"'+a.index+'","subindex":"'+a.subindex+'","which":"attribute"}'),b.text.attr("dt-data",'{"index":"'+a.index+'","subindex":"'+a.subindex+'","which":"value"}').attr("dt-default",a.labels.default).find("span.txt").text(a.labels.default),b.button.attr("title",a.labels.title).attr("dt-data",'{"index":"'+a.index+'","subindex":"'+a.subindex+'"}'),i()});case"delete_section":case"delete_subsection":g=function(){var c=a.closest("delete_section"===a.attr("dt-action")?".box":".sheet");e("files/php/controllers/delete.php",JSON.parse(a.attr("dt-data"))),b.win.modal("hide"),c.slideUp("slow",function(){c.remove()})};break;case"refill":g=function(){var c=JSON.parse(a.attr("dt-data")),d=a.closest(".sheet").find("span.txt");c.refill=!0,c.value=d.text().replace(d.parent().attr("dt-default"),""),e("files/php/controllers/update.php",c,function(){var a=b.win.find("div.modal-body"),c=b.win.find("div.modal-footer");a.html("<img src='files/assets/loading.gif' />"),c.text("")},function(c){var d=a.closest(".sheet").find("span.txt");d.hasClass("text-warning")&&d.removeClass("text-warning").text(""),d.text(c),b.win.modal("hide")})}}c(d($(this).attr("dt-action"))+(void 0===f.who?"":"<br/><b>"+f.who+"</b>")+(void 0===$(this).attr("dt-extra")?"":"<br/><small>"+$(this).attr("dt-extra")+"</small>"),"function"==typeof g?["continue","dismiss"]:["dismiss"],g)})};i()}a.indexOf("#actions#")>=0&&(b.actionButtons=$("button[role='command']"),b.actionButtons.on("click",function(){var f,a=$(this);switch($(this).attr("dt-action")){case"reset":case"recover_sections":case"recover_subsections":f=function(){e("files/php/controllers/"+("reset"===a.attr("dt-action")?"reset":"recover")+".php",JSON.parse(a.attr("dt-data")),"",function(){window.location.reload()})};break;case"pdf":return void window.open("pdf.php");case"blank":f=function(){var a=$(".text-warning");a.each(function(){$(this).removeClass("text-warning")}),b.form.submit()};break;case"full":f=function(){b.form.submit()}}c(d($(this).attr("dt-action")),"function"==typeof f?["continue","dismiss"]:["dismiss"],f)})),b.page.removeClass("hidden"),b.alert=$("span[dt-action='result']"),""!==b.alert.text()&&c(b.alert.text(),["dismiss"])});